# ==================== 行政事務簽核 ====================

# 行政任務類型
enum AdminTaskType {
  CREATE_FILE        # 建檔
  TERMINATION        # 廢聘
  LONG_TERM_CARE     # 長照求才
  RETURN_SUPPLEMENT  # 退補件
  RECRUITMENT_LETTER # 申請招募函
  HEALTH_CHECK       # 體檢(報告/核備)
  ENTRY_ONESTOP      # 一站式入境
  TAKEOVER_NOTIFY    # 承接通報(雙方合意)
  CERTIFICATION      # 印辦認證
  OTHER              # 其他
}

# 行政任務狀態
enum AdminTaskStatus {
  PENDING     # 待處理
  PROCESSING  # 處理中
  APPROVED    # 已批准
  REJECTED    # 已退回
  COMPLETED   # 已完成
}

# 審批路線
enum ApprovalRoute {
  V_ROUTE    # V 路線（主要審批）
  DASH_ROUTE # - 路線（次要審批）
}

# 簡化的用戶資訊
type TaskUser {
  id: ID!
  name: String
  email: String!
  role: String!
}

# 行政任務附件
type AdminTaskAttachment {
  id: ID!
  filename: String!
  originalName: String!
  mimeType: String!
  size: Int!
  path: String!
  url: String
  uploadedBy: String
  createdAt: String!
}

# 審批記錄
type ApprovalRecord {
  id: ID!
  taskId: Int!
  action: String!
  comment: String
  approver: TaskUser!
  createdAt: String!
}

# 行政任務
type AdminTask {
  id: ID!
  taskNo: String!
  taskType: AdminTaskType!
  title: String!

  # 關聯人員
  applicant: TaskUser!
  processor: TaskUser
  approver: TaskUser

  # 時間資訊
  applicationDate: String!
  deadline: String
  receivedAt: String
  completedAt: String

  # 狀態與路線
  status: AdminTaskStatus!
  approvalRoute: ApprovalRoute!
  approvalMark: String

  # 動態表單資料
  payload: JSON!

  # 備註
  notes: String

  # 附件
  attachments: [AdminTaskAttachment!]!

  # 審批記錄
  approvalRecords: [ApprovalRecord!]!

  createdAt: String!
  updatedAt: String!
}

# 分頁資訊
type AdminTaskPageInfo {
  total: Int!
  page: Int!
  pageSize: Int!
  totalPages: Int!
}

# 分頁的行政任務列表
type AdminTaskConnection {
  items: [AdminTask!]!
  pageInfo: AdminTaskPageInfo!
}

# 統計資訊
type AdminTaskStats {
  total: Int!
  pending: Int!
  processing: Int!
  approved: Int!
  rejected: Int!
  completed: Int!
  overdue: Int!
}

# 按類型統計
type TaskTypeStats {
  taskType: AdminTaskType!
  count: Int!
  completed: Int!
  pending: Int!
}

# ==================== Queries ====================

extend type Query {
  # 獲取行政任務列表（分頁）
  adminTasks(
    page: Int
    pageSize: Int
    status: AdminTaskStatus
    taskType: AdminTaskType
    applicantId: String
    processorId: String
    approverId: String
    search: String
    sortBy: String
    sortOrder: String
  ): AdminTaskConnection!

  # 獲取單個行政任務
  adminTask(id: Int!): AdminTask

  # 獲取行政任務統計
  adminTaskStats: AdminTaskStats!

  # 按類型統計
  adminTaskStatsByType: [TaskTypeStats!]!

  # 獲取待審批的任務（給 SUPER_ADMIN）
  pendingApprovalTasks(page: Int, pageSize: Int): AdminTaskConnection!

  # 獲取我的任務
  myAdminTasks(
    role: String  # applicant, processor, approver
    status: AdminTaskStatus
    page: Int
    pageSize: Int
  ): AdminTaskConnection!
}

# ==================== Inputs ====================

# 建檔表單 payload
input CreateFilePayload {
  employerName: String!           # 雇主名稱
  sourceType: String!             # 國內承接 or 國外引進
  workerName: String              # 移工姓名
  workerNationality: String       # 移工國籍
  workerPassportNo: String        # 護照號碼
  contractStartDate: String       # 合約開始日期
  contractEndDate: String         # 合約結束日期
  jobCategory: String             # 工作類別
  remarks: String                 # 備註
}

# 廢聘表單 payload
input TerminationPayload {
  employerName: String!           # 雇主名稱
  workerName: String!             # 移工姓名
  workerNationality: String       # 移工國籍
  terminationType: String!        # 廢聘類型（合意終止/期滿離境/逃跑/其他）
  terminationDate: String!        # 廢聘日期
  terminationReason: String       # 廢聘原因
  handoverStatus: String          # 交接狀態
  remarks: String                 # 備註
}

# 長照求才表單 payload
input LongTermCarePayload {
  employerName: String!           # 雇主/機構名稱
  employerType: String!           # 雇主類型（個人/機構）
  careType: String!               # 照護類型（居家照護/機構照護）
  patientInfo: String             # 被照護者資訊
  requiredSkills: [String!]       # 所需技能
  workLocation: String!           # 工作地點
  salaryRange: String             # 薪資範圍
  quantity: Int                   # 需求人數
  urgency: String                 # 緊急程度
  remarks: String                 # 備註
}

# 退補件表單 payload
input ReturnSupplementPayload {
  employerName: String!           # 雇主名稱
  workerName: String              # 移工姓名
  documentType: String!           # 文件類型
  returnReason: String!           # 退件原因
  supplementItems: [String!]      # 需補件項目
  originalSubmissionDate: String  # 原提交日期
  deadline: String                # 補件期限
  remarks: String                 # 備註
}

# 申請招募函表單 payload
input RecruitmentLetterPayload {
  employerName: String!           # 雇主名稱
  employerAddress: String         # 雇主地址
  jobCategory: String!            # 工作類別
  quantity: Int!                  # 招募人數
  nationality: [String!]          # 希望國籍
  salaryRange: String             # 薪資範圍
  workDescription: String         # 工作內容
  requirements: String            # 資格要求
  remarks: String                 # 備註
}

# 其他類型表單 payload（通用）
input OtherPayload {
  description: String!            # 事項描述
  details: String                 # 詳細說明
  relatedParties: [String!]       # 相關方
  remarks: String                 # 備註
}

# 創建行政任務輸入
input CreateAdminTaskInput {
  taskType: AdminTaskType!
  title: String!
  deadline: String
  approvalRoute: ApprovalRoute
  payload: JSON!
  notes: String
}

# 更新行政任務輸入
input UpdateAdminTaskInput {
  id: Int!
  title: String
  deadline: String
  processorId: String
  approverId: String
  approvalRoute: ApprovalRoute
  payload: JSON
  notes: String
}

# 審批操作輸入
input ApprovalInput {
  taskId: Int!
  action: String!  # approve, reject, request_revision
  comment: String
}

# 更新任務狀態輸入
input UpdateTaskStatusInput {
  taskId: Int!
  status: AdminTaskStatus!
  notes: String
}

# ==================== Mutations ====================

extend type Mutation {
  # 創建行政任務
  createAdminTask(input: CreateAdminTaskInput!): AdminTask!

  # 更新行政任務
  updateAdminTask(input: UpdateAdminTaskInput!): AdminTask!

  # 刪除行政任務
  deleteAdminTask(id: Int!): Boolean!

  # 審批操作
  approveTask(input: ApprovalInput!): AdminTask!

  # 更新任務狀態（完成人更新）
  updateTaskStatus(input: UpdateTaskStatusInput!): AdminTask!

  # 分配完成人
  assignProcessor(taskId: Int!, processorId: String!): AdminTask!

  # 分配審批人
  assignApprover(taskId: Int!, approverId: String!): AdminTask!

  # 上傳附件
  uploadTaskAttachment(taskId: Int!, file: JSON!): AdminTaskAttachment!

  # 刪除附件
  deleteTaskAttachment(attachmentId: Int!): Boolean!
}
